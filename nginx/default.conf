events {}

http {
    server {
        listen 80;
        server_name localhost;

        # Proxy pour l'API REST (accessible sur http://localhost/api/v1/)
        location /api/v1/ {
            proxy_pass http://rest_api:5000/api/v1/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Proxy pour Swagger (accessible sur http://localhost/swagger/)
        # Ici, on redirige vers Swagger qui sert son interface à /apidocs/
        location /swagger/ {
            proxy_pass http://swagger:5001/apidocs/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Proxy pour gRPC
        # Note : Pour utiliser grpc_pass, Nginx doit être compilé avec le support gRPC.
        location /grpc {
            grpc_pass grpc://grpc_service:50051;
        }
    }
}
